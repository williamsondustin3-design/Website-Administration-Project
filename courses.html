<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Courses - ClassConnect</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="download.png" alt="ClassConnect Logo">
      <h1>ClassConnect</h1>
    </div>
    <nav>
      <ul>
        <li><a href="ClassConnect.html">Home</a></li>
        <li><a href="courses.html" class="active">Courses</a></li>
        <li><a href="groups.html">Groups</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </header>

<main class="courses-page">

  <section class="course-search">
    <h2>Find Your Course</h2>
    <p>Search by course code or course name, then join the class from the results.</p>

    <div class="search-row">
      <input
        type="text"
        id="courseSearchInput"
        placeholder="e.g. CIS 350, Data Structures"
      >
      <button id="courseSearchButton">Search</button>
    </div>
    <p id="searchMessage" class="course-message"></p>
  </section>

  <section class="courses-layout">

    <div class="courses-column">
      <h3>Search Results</h3>
      <div id="searchResults">
        <p>Type a search above to see available courses.</p>
      </div>
    </div>

    <div class="courses-column">
      <h3>Joined Courses</h3>
      <div id="joinedCourses">
        <p>You haven't joined any courses yet.</p>
      </div>
    </div>

    <div class="courses-column" id="courseDetailSection" style="display:none;">
      <h3 id="courseTitle"></h3>
      <p id="courseMeta"></p>
      <button id="joinCourseButton" type="button">Join Course</button>
      <p id="joinStatus" class="course-message"></p>

      <hr>

      <h4>Posts</h4>
      <div id="postsList">
        <p>No posts yet. Be the first to share something!</p>
      </div>

      <h4>Add a new post</h4>
      <form id="newPostForm">
        <textarea
          id="newPostText"
          rows="3"
          placeholder="Share something with the class..."
          required
        ></textarea>
        <button type="submit">Post</button>
      </form>
    </div>
  </section>
</main>

<script>
  const allCourses = [
    { code: "CIS350", name: "Data Structures", term: "Fall 2025", instructor: "Dr. Smith",
      description: "Core concepts of data structures including lists, stacks, queues, and trees." },
    { code: "CIS340", name: "Web Development", term: "Fall 2025", instructor: "Prof. Johnson",
      description: "HTML, CSS, JavaScript, and front-end app design." },
    { code: "MATH110", name: "College Algebra", term: "Fall 2025", instructor: "Dr. Lee",
      description: "Functions, graphs, and algebraic problem solving." },
    { code: "ENG101", name: "English Composition", term: "Fall 2025", instructor: "Dr. Brown",
      description: "Academic writing, argumentation, and research skills." }
  ];

  const STORAGE_JOINED = "classconnect_joinedCourses";

  let joinedCourses = loadJoinedCourses();
  let currentCourseCode = null;

  function loadJoinedCourses() {
    const saved = localStorage.getItem(STORAGE_JOINED);
    if (!saved) return [];
    try {
      return JSON.parse(saved);
    } catch (e) {
      console.error("Error parsing joined courses:", e);
      return [];
    }
  }

  function saveJoinedCourses() {
    localStorage.setItem(STORAGE_JOINED, JSON.stringify(joinedCourses));
  }

  function escapeHtml(str) {
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function renderSearchResults(courses) {
    const container = document.getElementById("searchResults");

    if (!courses || courses.length === 0) {
      container.innerHTML = "<p>No courses found. Try a different search.</p>";
      return;
    }

    container.innerHTML = courses
      .map((c) => {
        const joined = joinedCourses.includes(c.code);
        return `
          <article class="course-card">
            <h4>${escapeHtml(c.code)} - ${escapeHtml(c.name)}</h4>
            <p>${escapeHtml(c.description)}</p>
            <p><strong>Term:</strong> ${escapeHtml(c.term)} | <strong>Instructor:</strong> ${escapeHtml(c.instructor)}</p>
            <button
              type="button"
              class="view-course-btn"
              data-code="${escapeHtml(c.code)}"
            >
              View Course
            </button>
            ${joined ? '<span class="badge">Joined</span>' : ""}
          </article>
        `;
      })
      .join("");

    const buttons = container.querySelectorAll(".view-course-btn");
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const code = btn.getAttribute("data-code");
        showCourseDetail(code);
      });
    });
  }

  function renderJoinedCourses() {
    const container = document.getElementById("joinedCourses");

    if (!joinedCourses || joinedCourses.length === 0) {
      container.innerHTML = "<p>You haven't joined any courses yet.</p>";
      return;
    }

    const joinedDetails = joinedCourses
      .map((code) => allCourses.find((c) => c.code === code))
      .filter(Boolean);

    container.innerHTML = `
      <ul class="joined-courses-list">
        ${joinedDetails
          .map(
            (c) => `
              <li>
                <button
                  type="button"
                  class="joined-course-btn"
                  data-code="${escapeHtml(c.code)}"
                >
                  ${escapeHtml(c.code)} - ${escapeHtml(c.name)}
                </button>
              </li>
            `
          )
          .join("")}
      </ul>
    `;

    const buttons = container.querySelectorAll(".joined-course-btn");
    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const code = btn.getAttribute("data-code");
        showCourseDetail(code);
      });
    });
  }

  function showCourseDetail(code) {
    const course = allCourses.find((c) => c.code === code);
    const section = document.getElementById("courseDetailSection");
    const title   = document.getElementById("courseTitle");
    const meta    = document.getElementById("courseMeta");
    const joinBtn = document.getElementById("joinCourseButton");
    const joinStatus = document.getElementById("joinStatus");

    if (!course) {
      section.style.display = "none";
      return;
    }

    currentCourseCode = course.code;

    section.style.display = "block";
    title.textContent = `${course.code} - ${course.name}`;
    meta.textContent  = `${course.term} â€¢ Instructor: ${course.instructor}`;

    const isJoined = joinedCourses.includes(course.code);
    joinBtn.textContent = isJoined ? "Joined" : "Join Course";
    joinBtn.disabled = isJoined;
    joinStatus.textContent = isJoined
      ? "You have already joined this course."
      : "";
  }

  function handleSearch() {
    const input = document.getElementById("courseSearchInput");
    const msg   = document.getElementById("searchMessage");
    const query = input.value.trim().toLowerCase();

    if (!query) {
      msg.textContent = "";
      renderSearchResults(allCourses);
      return;
    }

    const filtered = allCourses.filter((c) => {
      return (
        c.code.toLowerCase().includes(query) ||
        c.name.toLowerCase().includes(query)
      );
    });

    msg.textContent = `Found ${filtered.length} course(s) matching "${input.value.trim()}"`;
    renderSearchResults(filtered);
  }

  function handleJoinCurrentCourse() {
    if (!currentCourseCode) return;

    const code = currentCourseCode;
    const joinBtn    = document.getElementById("joinCourseButton");
    const joinStatus = document.getElementById("joinStatus");

    if (!joinedCourses.includes(code)) {
      joinedCourses.push(code);
      saveJoinedCourses();
    }

    joinBtn.textContent = "Joined";
    joinBtn.disabled = true;
    joinStatus.textContent = "You have joined this course.";

    renderJoinedCourses();
    handleSearch();
  }

  document.addEventListener("DOMContentLoaded", () => {
    renderSearchResults(allCourses);
    renderJoinedCourses();

    const searchInput  = document.getElementById("courseSearchInput");
    const searchButton = document.getElementById("courseSearchButton");
    searchButton.addEventListener("click", handleSearch);
    searchInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter") {
        handleSearch();
      }
    });

    const joinBtn = document.getElementById("joinCourseButton");
    joinBtn.addEventListener("click", handleJoinCurrentCourse);
  });
</script>
</body>
</html>





