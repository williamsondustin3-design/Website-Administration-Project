<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Groups - ClassConnect</title>

  <!-- Keep project stylesheet, but include important local styles for layout & accessibility improvements -->
  <link rel="stylesheet" href="style.css" />
  <style>
    :root{
      --accent:#2a9d8f;
      --muted:#6b7280;
      --bg:#f7fafc;
      --card:#ffffff;
      --radius:8px;
      --gap:16px;
    }

    body{
      margin:0;
      font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:#111827;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      background:linear-gradient(90deg, #0f172a 0%, #1f2937 100%);
      color:#fff;
      padding:12px 20px;
    }
    .logo-container{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .logo-container img{ width:44px; height:44px; object-fit:cover; border-radius:6px; }
    header h1{ font-size:1.2rem; margin:0; }

    nav ul{
      list-style:none;
      display:flex;
      gap:12px;
      margin:0;
      padding:0;
      align-items:center;
    }
    nav a{
      color:rgba(255,255,255,0.9);
      text-decoration:none;
      padding:8px 10px;
      border-radius:6px;
    }
    nav a.active, nav a:hover{ background:rgba(255,255,255,0.06); }

    main{
      max-width:1100px;
      margin:20px auto;
      padding:0 16px 80px;
    }

    .controls{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
      margin-bottom:18px;
    }

    .filters-bar{
      display:flex;
      gap:8px;
      align-items:center;
      background:var(--card);
      padding:12px;
      border-radius:var(--radius);
      box-shadow:0 1px 4px rgba(2,6,23,0.06);
    }

    .filters-bar label{ font-size:0.9rem; color:var(--muted); margin-right:6px; }
    select, input[type="search"], button{
      padding:8px 10px;
      border:1px solid #e6e9ee;
      border-radius:6px;
      background: #fff;
      font-size:0.95rem;
    }

    .sub-filters{ display:flex; gap:8px; align-items:center; }

    .groups-container .content{
      margin-top:12px;
      background:transparent;
    }

    .groups-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
      gap:16px;
      margin-top:12px;
    }

    .group-card{
      background:var(--card);
      border-radius:10px;
      padding:14px;
      box-shadow:0 6px 12px rgba(2,6,23,0.06);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:120px;
    }
    .group-card h4{ margin:0; font-size:1.05rem; }
    .group-meta{ font-size:0.85rem; color:var(--muted); display:flex; gap:8px; flex-wrap:wrap;}
    .group-actions{ margin-top:auto; display:flex; gap:8px; align-items:center; }
    .join-btn{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
    }
    .join-btn[aria-pressed="true"]{ background:#0b6a5c; }
    .secondary-btn{
      background:transparent;
      border:1px solid #e6e9ee;
      color:#111827;
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
    }

    .no-results{
      padding:18px;
      text-align:center;
      color:var(--muted);
      background:var(--card);
      border-radius:8px;
      margin-top:12px;
    }

    /* small helper for hidden elements toggling via JS */
    .hidden{ display:none !important; }

    /* responsive tweaks */
    @media (max-width:520px){
      .filters-bar{ flex-direction:column; align-items:stretch; }
      nav ul{ display:none; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <img src="download.png" alt="ClassConnect Logo">
      <div>
        <h1>ClassConnect</h1>
        <div style="font-size:0.85rem; color:rgba(255,255,255,0.8)">Groups & communities</div>
      </div>
    </div>

    <nav aria-label="Main navigation">
      <ul>
        <li><a href="ClassConnect.html">Home</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="groups.html" class="active">Groups</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="controls" aria-labelledby="filters-heading">
      <h2 id="filters-heading" class="hidden">Group filters</h2>

      <div class="filters-bar" role="region" aria-label="Group filters">
        <label for="categorySelect">Category</label>
        <select id="categorySelect" aria-controls="subFilters" aria-describedby="category-help">
          <option value="">All</option>
          <option value="subject">Subject</option>
          <option value="year">School Year</option>
          <option value="interest">Interests</option>
        </select>

        <div id="subFilters" class="sub-filters" aria-live="polite">
          <!-- Sub-dropdowns: they will show/hide depending on category. include default empty option to mean 'any' -->
          <div id="subjectOptions" class="hidden">
            <label for="subjectSelect" class="sr-only">Subject</label>
            <select id="subjectSelect">
              <option value="">Any subject</option>
              <option value="computer-science">Computer Science</option>
              <option value="math">Mathematics</option>
              <option value="english">English</option>
              <option value="history">History</option>
            </select>
          </div>

          <div id="yearOptions" class="hidden">
            <label for="yearSelect" class="sr-only">School year</label>
            <select id="yearSelect">
              <option value="">Any year</option>
              <option value="freshman">Freshmen</option>
              <option value="sophomore">Sophomores</option>
              <option value="junior">Juniors</option>
              <option value="senior">Seniors</option>
            </select>
          </div>

          <div id="interestOptions" class="hidden">
            <label for="interestSelect" class="sr-only">Interest</label>
            <select id="interestSelect">
              <option value="">Any interest</option>
              <option value="coding">Coding</option>
              <option value="debate">Debate</option>
              <option value="sports">Sports</option>
              <option value="arts">Arts</option>
            </select>
          </div>
        </div>

        <label for="groupSearch" class="sr-only">Search groups</label>
        <input id="groupSearch" type="search" placeholder="Search groups..." aria-label="Search groups by name or description">

        <button id="resetFilters" class="secondary-btn" title="Reset filters">Reset</button>
      </div>
    </section>

    <section class="groups-container" aria-labelledby="groups-heading">
      <div class="content">
        <h2 id="groups-heading">Groups</h2>
        <p>Browse and join student groups. Use the filters or search to find groups that match your interests.</p>

        <div id="groupsGrid" class="groups-grid" role="list">
          <!-- Example group cards with data attributes. Each card has a data-id for join persistence -->
          <article class="group-card" role="listitem" data-id="g1" data-subject="computer-science" data-year="freshman" data-interest="coding">
            <h4>Intro to Computer Science</h4>
            <div class="group-meta">Subject: Computer Science • Year: Freshmen • Interest: Coding</div>
            <p>Study group for the introductory CS course. Share resources and ask questions.</p>
            <div class="group-actions">
              <button class="join-btn" aria-pressed="false">Join Group</button>
              <button class="secondary-btn" data-action="preview">Preview</button>
            </div>
          </article>

          <article class="group-card" role="listitem" data-id="g2" data-subject="math" data-year="senior" data-interest="">
            <h4>Senior Math Circle</h4>
            <div class="group-meta">Subject: Mathematics • Year: Seniors</div>
            <p>Advanced problem-solving and exam prep for senior math students.</p>
            <div class="group-actions">
              <button class="join-btn" aria-pressed="false">Join Group</button>
              <button class="secondary-btn" data-action="preview">Preview</button>
            </div>
          </article>

          <article class="group-card" role="listitem" data-id="g3" data-subject="english" data-year="junior" data-interest="debate">
            <h4>Debate & Rhetoric</h4>
            <div class="group-meta">Subject: English • Year: Juniors • Interest: Debate</div>
            <p>Practice debating skills and speech-writing with peers.</p>
            <div class="group-actions">
              <button class="join-btn" aria-pressed="false">Join Group</button>
              <button class="secondary-btn" data-action="preview">Preview</button>
            </div>
          </article>

          <article class="group-card" role="listitem" data-id="g4" data-subject="" data-year="senior" data-interest="sports">
            <h4>Sports Enthusiasts</h4>
            <div class="group-meta">Year: Seniors • Interest: Sports</div>
            <p>Organize pickup games and discuss athletics and fitness.</p>
            <div class="group-actions">
              <button class="join-btn" aria-pressed="false">Join Group</button>
              <button class="secondary-btn" data-action="preview">Preview</button>
            </div>
          </article>

          <article class="group-card" role="listitem" data-id="g5" data-subject="computer-science" data-year="junior" data-interest="coding">
            <h4>Project Partners — CS</h4>
            <div class="group-meta">Subject: Computer Science • Year: Juniors • Interest: Coding</div>
            <p>Find teammates for projects, code reviews and pair programming.</p>
            <div class="group-actions">
              <button class="join-btn" aria-pressed="false">Join Group</button>
              <button class="secondary-btn" data-action="preview">Preview</button>
            </div>
          </article>
        </div>

        <div id="noResults" class="no-results hidden" role="status" aria-live="polite">No groups match your filters.</div>
      </div>
    </section>
  </main>

  <script>
    // Elements
    const categorySelect = document.getElementById("categorySelect");
    const subjectOptions = document.getElementById("subjectOptions");
    const yearOptions = document.getElementById("yearOptions");
    const interestOptions = document.getElementById("interestOptions");

    const subjectSelect = document.getElementById("subjectSelect");
    const yearSelect = document.getElementById("yearSelect");
    const interestSelect = document.getElementById("interestSelect");

    const groupSearch = document.getElementById("groupSearch");
    const resetFilters = document.getElementById("resetFilters");
    const groupsGrid = document.getElementById("groupsGrid");
    const groupCards = Array.from(document.querySelectorAll('.group-card'));
    const noResults = document.getElementById('noResults');

    // Utility: show/hide sub filters based on category
    function updateSubFilterVisibility() {
      const val = categorySelect.value;
      subjectOptions.classList.add('hidden');
      yearOptions.classList.add('hidden');
      interestOptions.classList.add('hidden');

      if (val === 'subject') subjectOptions.classList.remove('hidden');
      else if (val === 'year') yearOptions.classList.remove('hidden');
      else if (val === 'interest') interestOptions.classList.remove('hidden');
    }

    // Filtering logic: category + sub-select + search
    function filterGroups() {
      const cat = categorySelect.value;
      const subject = subjectSelect.value;
      const year = yearSelect.value;
      const interest = interestSelect.value;
      const q = groupSearch.value.trim().toLowerCase();

      let visibleCount = 0;

      groupCards.forEach(card => {
        let keep = true;

        // apply category constraint if selected
        if (cat === 'subject' && subject) {
          keep = card.dataset.subject === subject;
        } else if (cat === 'year' && year) {
          keep = card.dataset.year === year;
        } else if (cat === 'interest' && interest) {
          keep = card.dataset.interest === interest;
        }

        // search filter (name or description)
        if (keep && q) {
          const title = (card.querySelector('h4')?.textContent || '').toLowerCase();
          const desc = (card.querySelector('p')?.textContent || '').toLowerCase();
          keep = title.includes(q) || desc.includes(q);
        }

        // apply final visibility
        if (keep) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      // show 'no results' message when nothing matches
      if (visibleCount === 0) {
        noResults.classList.remove('hidden');
      } else {
        noResults.classList.add('hidden');
      }
    }

    // Reset filters to defaults
    function resetAllFilters() {
      categorySelect.value = '';
      subjectSelect.value = '';
      yearSelect.value = '';
      interestSelect.value = '';
      groupSearch.value = '';
      updateSubFilterVisibility();
      filterGroups();
    }

    // Join button behavior with localStorage persistence
    function loadJoinedState() {
      let joined = {};
      try {
        joined = JSON.parse(localStorage.getItem('joinedGroups') || '{}');
      } catch(e) { joined = {}; }
      groupCards.forEach(card => {
        const id = card.dataset.id;
        const btn = card.querySelector('.join-btn');
        if (joined[id]) {
          btn.textContent = 'Joined';
          btn.setAttribute('aria-pressed', 'true');
        } else {
          btn.textContent = 'Join Group';
          btn.setAttribute('aria-pressed', 'false');
        }
      });
    }

    function toggleJoin(btn, card) {
      const id = card.dataset.id;
      let joined = {};
      try {
        joined = JSON.parse(localStorage.getItem('joinedGroups') || '{}');
      } catch(e) { joined = {}; }

      const isJoined = btn.getAttribute('aria-pressed') === 'true';
      if (isJoined) {
        // leave group
        delete joined[id];
        btn.textContent = 'Join Group';
        btn.setAttribute('aria-pressed', 'false');
      } else {
        // join group
        joined[id] = { joinedAt: new Date().toISOString() };
        btn.textContent = 'Joined';
        btn.setAttribute('aria-pressed', 'true');
      }
      localStorage.setItem('joinedGroups', JSON.stringify(joined));
    }

    // Event wiring
    categorySelect.addEventListener('change', () => {
      updateSubFilterVisibility();
      filterGroups();
    });

    [subjectSelect, yearSelect, interestSelect].forEach(el => {
      el.addEventListener('change', filterGroups);
    });

    groupSearch.addEventListener('input', debounce(filterGroups, 220));

    resetFilters.addEventListener('click', resetAllFilters);

    // Attach join button handlers
    groupsGrid.addEventListener('click', (e) => {
      const btn = e.target.closest('.join-btn');
      if (btn) {
        const card = btn.closest('.group-card');
        toggleJoin(btn, card);
      }
      // preview button example (non-blocking)
      const previewBtn = e.target.closest('button[data-action="preview"]');
      if (previewBtn) {
        const card = previewBtn.closest('.group-card');
        const title = card.querySelector('h4')?.textContent || 'Group';
        alert(title + '\\n\\n' + (card.querySelector('p')?.textContent || 'No description.'));
      }
    });

    // Small debounce helper
    function debounce(fn, wait){
      let t;
      return function(...args){
        clearTimeout(t);
        t = setTimeout(()=>fn.apply(this,args), wait);
      };
    }

    // Initial setup
    updateSubFilterVisibility();
    loadJoinedState();
    filterGroups();

    // Accessibility helper: hide visually but keep accessible
    (function addSRStyles(){
      const style = document.createElement('style');
      style.textContent = '.sr-only{ position:absolute !important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;}';
      document.head.appendChild(style);
    })();
  </script>
</body>
</html>
